!function t(e,n,i){function a(o,s){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[o]={exports:{}};e[o][0].call(d.exports,function(t){var n=e[o][1][t];return a(n||t)},d,d.exports,t,e,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={apiKey:"AIzaSyBWk9EWPkkvqiruG8aYnHV0dBPg1z3EtN4",authDomain:"charter-ecb07.firebaseapp.com",databaseURL:"https://charter-ecb07.firebaseio.com",projectId:"charter-ecb07",storageBucket:"",messagingSenderId:"134239305153"};n.config=i},{}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Database=function(t,e){var n=t.initializeApp(e,"Charter Database"),i=n.database(),a=n.auth();e.localhost=!0,e.noScreenshots=!0;var r=Prometheus(e,n),o={init:function(t,e){var n=!1;a.onAuthStateChanged(function(i){i?(r.logon(i.uid,{name:i.displayName,email:i.email,image:i.photoURL,uid:i.uid}),n||(n=!0,t(i))):n||(n=!0,e())})},login:function(e){var n=new t.auth.GoogleAuthProvider;a.signInWithPopup(n).then(function(t){t.credential.accessToken;var n=t.user;r.logon(n.uid,{name:n.displayName,email:n.email,image:n.photoURL,uid:n.uid}),e(n)}).catch(function(t){console.error(t)})},getPrometheus:function(){return r},getCurrentUser:function(){return a.currentUser||{}},saveFeedback:function(t,e,n){return i.ref("feedback").push({tid:t,uid:e,feedback:n,timestamp:Date.now()})},getUser:function(t){return new Promise(function(e,n){i.ref("prometheus/users/"+t+"/profile").once("value",function(t){var n=t.val();e(n)}).catch(n)})},getTeam:function(t){return new Promise(function(e,n){i.ref("teams/"+t).once("value",function(t){var n=t.val();e(n)}).catch(n)})},onTeamChange:function(t,e,n){if(!t)throw Error("No team id given.");var a={};i.ref("teams/"+t).on("value",function(t){var n=[],i=t.val()||{},r=i.members||{};for(var s in r)if(!(s in a)){var c=o.getUser(s);c.uid=s,n.push(c)}n.length>0?Promise.all(n).then(function(t){t.forEach(function(t,e){var i=n[e].uid;a[i]=t}),e(i,a)}):e(i,a)})},updateTeamName:function(t,e,n){if(!t)throw Error("No team id given.");return i.ref("teams/"+t+"/name").set(n)},updateQuestion:function(t,e,n){if(!t)throw Error("No team id given.");return i.ref("teams/"+t+"/question").set(n)},updateExpectations:function(t,e,n){if(!t)throw Error("No team id given.");return i.ref("teams/"+t+"/expectations").set(n)},submitUpdate:function(t,e,n){if(!t)throw Error("No team id given.");if(!e)throw Error("No user id given.");return i.ref("teams/"+t+"/updates/"+e).push({update:n,timestamp:Date.now()})},joinTeam:function(t,e,n){if(!t)throw Error("No team id given.");if(!e)throw Error("No user id given");return new Promise(function(i,a){o.getTeam(t).then(function(r){n!==r.joinCode&&r.joinCode||o.addMember(t,e).then(i).catch(a)}).catch(a)})},addMember:function(t,e){return i.ref("teams/"+t+"/members/"+e).set({status:"member",role:"Team Member",joined:Date.now(),member:!0})},getAllTeams:function(t){return new Promise(function(e,n){i.ref("teams").orderByChild("members/"+t+"/member").startAt(!0).endAt(!0).once("value",function(t){var n=t.val()||{};e(n)}).catch(n)})}};return o}},{}],3:[function(t,e,n){"use strict";function i(t){c(function(e){console.log("Charter by Omnipointment."),console.log(t),o("fill-user-name",t.displayName),s("fill-user-image",t.photoURL);l.getPrometheus();console.log(e),p.addEventListener("click",function(t){vex.dialog.prompt({message:"What feedback do you have to share with us?",callback:function(t){if(t){var n=l.getCurrentUser().uid;l.saveFeedback(e,n,t).then(function(t){vex.dialog.alert("Thank you for your feedback, it really helps us a lot!")}).catch(r)}}})}),h.addEventListener("click",function(t){l.getTeam(e).then(function(t){var n=""+window.location.origin+window.location.pathname+"?team="+e;t.joinCode;vex.dialog.prompt({message:"Send this link to your teammates:",value:n,callback:function(){}})})}),b.addEventListener("input",function(t){var e=t.target.innerText.split("\n").reduce(function(t,e){return e?t+e:t},"");t.target.innerText=e,cursorManager.setEndOfContenteditable(t.target)}),b.addEventListener("keypress",function(t){if(13==(t.keyCode||t.which)){var n=t.target.innerText,i=l.getCurrentUser().uid;l.updateTeamName(e,i,n)}}),y.addEventListener("click",function(t){y.classList.add("is-loading");var n=l.getCurrentUser().uid,i=E.innerText;l.updateQuestion(e,n,i).then(function(t){y.classList.remove("is-loading")}).catch(r)}),T.addEventListener("click",function(t){T.classList.add("is-loading");var n=l.getCurrentUser().uid,i=w.innerText.split("\n"),a=i.pop();!a.length<1&&i.push(a),l.updateExpectations(e,n,i).then(function(t){T.classList.remove("is-loading")}).catch(r)}),L.addEventListener("click",function(t){L.classList.add("is-loading");var n=l.getCurrentUser().uid,i=k.value;l.submitUpdate(e,n,i).then(function(t){L.classList.remove("is-loading")}).catch(r)}),l.onTeamChange(e,function(t,e){console.log(t),Object.keys(t).length>0&&a(t,e)},r)})}function a(t,e){o("fill-team-name",t.name),cursorManager.setEndOfContenteditable(b),o("fill-team-question",t.question);var n=t.expectations||[];w.innerHTML=n.reduce(function(t,e){return t+"<li>"+e+"</li>"},""),C.innerHTML="";for(var i in t.members)!function(n){var i=e[n],a=t.updates[n]||{},r=Object.keys(a).map(function(t){return a[t]}).sort(function(t,e){return e.timestamp-t.timestamp})[0],o="No updates yet.",s=i.joined;r&&(o=r.update,s=r.timestamp);var c=v.getRoleAndUpdateTile({name:i.name,role:t.members[n].role,image:i.image,update:o,timestamp:s});C.appendChild(c)}(i)}function r(t){vex.dialog.alert(t)}function o(t,e){for(var n=document.getElementsByClassName(t),i=0;i<n.length;i++)n[i].innerText=e}function s(t,e){console.log(e);for(var n=document.getElementsByClassName(t),i=0;i<n.length;i++)console.log(e),n[i].src=e}function c(t){f?t(f):vex.dialog.prompt({message:"Enter your team code:",callback:function(e){e?t(e):x>=1?window.location="./":(x++,c(t))}})}var u=t("./config"),d=t("./database"),m=t("./views"),l=(0,d.Database)(firebase,u.config),f=function(t){t=t.split("+").join(" ");for(var e,n={},i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n}(document.location.search).team,v=(0,m.Views)(),g=document.getElementById("login"),p=document.getElementById("feedback"),h=document.getElementById("invite"),b=document.getElementById("team-name"),E=document.getElementById("team-question"),y=document.getElementById("save-question"),w=document.getElementById("team-expectations"),T=document.getElementById("save-expectations"),k=document.getElementById("my-update"),L=document.getElementById("save-update"),C=document.getElementById("team-updates");g.addEventListener("click",function(t){l.login(i)}),l.init(i,function(){});var x=0},{"./config":1,"./database":2,"./views":4}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Views=function(){return{getRoleAndUpdateTile:function(t){var e=new Date(t.timestamp),n=moment(e).format("M/D h:mm A"),i=moment(Date.now()).diff(moment(t.timestamp)),a=moment.duration(i).asDays(),r="is-success";a>=5?r="is-danger":a>=3&&(r="is-warning");var o='\n\t\t\t\t<div class="tile is-parent is-vertical is-5">\n\t\t\t\t\t<div class="tile is-child">\n\t\t\t\t\t\t<div class="media">\n\t\t\t\t\t\t\t<figure class="media-left">\n\t\t\t\t\t\t\t\t<p class="image is-64x64">\n\t\t\t\t\t\t\t\t\t<img src="'+t.image+'">\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</figure>\n\t\t\t\t\t\t\t<div class="media-content content">\n\t\t\t\t\t\t\t\t<h3 class="title">'+t.name+'</h3>\n\t\t\t\t\t\t\t\t<p class="subtitle">'+t.role+'</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tile is-parent is-vertical is-7">\n\t\t\t\t\t<div class="tile is-child">\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t<span class="tag '+r+'">'+n+"</span> "+t.update+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>",s=document.createElement("div");return s.classList.add("tile"),s.innerHTML=o,s},getTeamTile:function(t){var e=window.location.origin+"/charter.html?team="+t.tid,n='\n\t\t\t\t<div class="content">\n\t\t\t\t\t<h1 class="title">'+t.name+'</h1>\n\t\t\t\t</div>\n\t\t\t\t<a href="'+e+'" class="button is-primary is-outlined">View Team Charter</a>',i=document.createElement("div");return i.classList.add("column"),i.classList.add("box"),i.classList.add("is-4"),i.innerHTML=n,i}}}},{}]},{},[3]);
//# sourceMappingURL=maps/main.js.map
